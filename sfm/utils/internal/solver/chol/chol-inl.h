// Copyright (c) Meta Platforms, Inc. and affiliates.
//
// This source code is licensed under the MIT license found in the
// LICENSE file in the root directory of this source tree.

#pragma once

#define ComputeL_1x1(L00) L00 = sqrt(L00);

#define ComputeL_2x2(L00, L10, L11)                                            \
  L00 = sqrt(L00);                                                             \
  L10 /= L00;                                                                  \
  L11 -= L10 * L10;                                                            \
  ComputeL_1x1(L11)

#define ComputeL_3x3(L00, L10, L11, L20, L21, L22)                             \
  L00 = sqrt(L00);                                                             \
  L10 /= L00;                                                                  \
  L20 /= L00;                                                                  \
  L11 -= L10 * L10;                                                            \
  L21 -= L20 * L10;                                                            \
  L22 -= L20 * L20;                                                            \
  ComputeL_2x2(L11, L21, L22)

#define ComputeL_4x4(L00, L10, L11, L20, L21, L22, L30, L31, L32, L33)         \
  L00 = sqrt(L00);                                                             \
  L10 /= L00;                                                                  \
  L20 /= L00;                                                                  \
  L30 /= L00;                                                                  \
  L11 -= L10 * L10;                                                            \
  L21 -= L20 * L10;                                                            \
  L22 -= L20 * L20;                                                            \
  L31 -= L30 * L10;                                                            \
  L32 -= L30 * L20;                                                            \
  L33 -= L30 * L30;                                                            \
  ComputeL_3x3(L11, L21, L22, L31, L32, L33)

#define ComputeL_5x5(L00, L10, L11, L20, L21, L22, L30, L31, L32, L33, L40,    \
                     L41, L42, L43, L44)                                       \
  L00 = sqrt(L00);                                                             \
  L10 /= L00;                                                                  \
  L20 /= L00;                                                                  \
  L30 /= L00;                                                                  \
  L40 /= L00;                                                                  \
  L11 -= L10 * L10;                                                            \
  L21 -= L20 * L10;                                                            \
  L22 -= L20 * L20;                                                            \
  L31 -= L30 * L10;                                                            \
  L32 -= L30 * L20;                                                            \
  L33 -= L30 * L30;                                                            \
  L41 -= L40 * L10;                                                            \
  L42 -= L40 * L20;                                                            \
  L43 -= L40 * L30;                                                            \
  L44 -= L40 * L40;                                                            \
  ComputeL_4x4(L11, L21, L22, L31, L32, L33, L41, L42, L43, L44)

#define ComputeL_6x6(L00, L10, L11, L20, L21, L22, L30, L31, L32, L33, L40,    \
                     L41, L42, L43, L44, L50, L51, L52, L53, L54, L55)         \
  L00 = sqrt(L00);                                                             \
  L10 /= L00;                                                                  \
  L20 /= L00;                                                                  \
  L30 /= L00;                                                                  \
  L40 /= L00;                                                                  \
  L50 /= L00;                                                                  \
  L11 -= L10 * L10;                                                            \
  L21 -= L20 * L10;                                                            \
  L22 -= L20 * L20;                                                            \
  L31 -= L30 * L10;                                                            \
  L32 -= L30 * L20;                                                            \
  L33 -= L30 * L30;                                                            \
  L41 -= L40 * L10;                                                            \
  L42 -= L40 * L20;                                                            \
  L43 -= L40 * L30;                                                            \
  L44 -= L40 * L40;                                                            \
  L51 -= L50 * L10;                                                            \
  L52 -= L50 * L20;                                                            \
  L53 -= L50 * L30;                                                            \
  L54 -= L50 * L40;                                                            \
  L55 -= L50 * L50;                                                            \
  ComputeL_5x5(L11, L21, L22, L31, L32, L33, L41, L42, L43, L44, L51, L52,     \
               L53, L54, L55)

#define ComputeL_7x7(L00, L10, L11, L20, L21, L22, L30, L31, L32, L33, L40,    \
                     L41, L42, L43, L44, L50, L51, L52, L53, L54, L55, L60,    \
                     L61, L62, L63, L64, L65, L66)                             \
  L00 = sqrt(L00);                                                             \
  L10 /= L00;                                                                  \
  L20 /= L00;                                                                  \
  L30 /= L00;                                                                  \
  L40 /= L00;                                                                  \
  L50 /= L00;                                                                  \
  L60 /= L00;                                                                  \
  L11 -= L10 * L10;                                                            \
  L21 -= L20 * L10;                                                            \
  L22 -= L20 * L20;                                                            \
  L31 -= L30 * L10;                                                            \
  L32 -= L30 * L20;                                                            \
  L33 -= L30 * L30;                                                            \
  L41 -= L40 * L10;                                                            \
  L42 -= L40 * L20;                                                            \
  L43 -= L40 * L30;                                                            \
  L44 -= L40 * L40;                                                            \
  L51 -= L50 * L10;                                                            \
  L52 -= L50 * L20;                                                            \
  L53 -= L50 * L30;                                                            \
  L54 -= L50 * L40;                                                            \
  L55 -= L50 * L50;                                                            \
  L61 -= L60 * L10;                                                            \
  L62 -= L60 * L20;                                                            \
  L63 -= L60 * L30;                                                            \
  L64 -= L60 * L40;                                                            \
  L65 -= L60 * L50;                                                            \
  L66 -= L60 * L60;                                                            \
  ComputeL_6x6(L11, L21, L22, L31, L32, L33, L41, L42, L43, L44, L51, L52,     \
               L53, L54, L55, L61, L62, L63, L64, L65, L66)

#define ComputeL_8x8(L00, L10, L11, L20, L21, L22, L30, L31, L32, L33, L40,    \
                     L41, L42, L43, L44, L50, L51, L52, L53, L54, L55, L60,    \
                     L61, L62, L63, L64, L65, L66, L70, L71, L72, L73, L74,    \
                     L75, L76, L77)                                            \
  L00 = sqrt(L00);                                                             \
  L10 /= L00;                                                                  \
  L20 /= L00;                                                                  \
  L30 /= L00;                                                                  \
  L40 /= L00;                                                                  \
  L50 /= L00;                                                                  \
  L60 /= L00;                                                                  \
  L70 /= L00;                                                                  \
  L11 -= L10 * L10;                                                            \
  L21 -= L20 * L10;                                                            \
  L22 -= L20 * L20;                                                            \
  L31 -= L30 * L10;                                                            \
  L32 -= L30 * L20;                                                            \
  L33 -= L30 * L30;                                                            \
  L41 -= L40 * L10;                                                            \
  L42 -= L40 * L20;                                                            \
  L43 -= L40 * L30;                                                            \
  L44 -= L40 * L40;                                                            \
  L51 -= L50 * L10;                                                            \
  L52 -= L50 * L20;                                                            \
  L53 -= L50 * L30;                                                            \
  L54 -= L50 * L40;                                                            \
  L55 -= L50 * L50;                                                            \
  L61 -= L60 * L10;                                                            \
  L62 -= L60 * L20;                                                            \
  L63 -= L60 * L30;                                                            \
  L64 -= L60 * L40;                                                            \
  L65 -= L60 * L50;                                                            \
  L66 -= L60 * L60;                                                            \
  L71 -= L70 * L10;                                                            \
  L72 -= L70 * L20;                                                            \
  L73 -= L70 * L30;                                                            \
  L74 -= L70 * L40;                                                            \
  L75 -= L70 * L50;                                                            \
  L76 -= L70 * L60;                                                            \
  L77 -= L70 * L70;                                                            \
  ComputeL_7x7(L11, L21, L22, L31, L32, L33, L41, L42, L43, L44, L51, L52,     \
               L53, L54, L55, L61, L62, L63, L64, L65, L66, L71, L72, L73,     \
               L74, L75, L76, L77)

#define ComputeL_9x9(                                                          \
    L00, L10, L11, L20, L21, L22, L30, L31, L32, L33, L40, L41, L42, L43, L44, \
    L50, L51, L52, L53, L54, L55, L60, L61, L62, L63, L64, L65, L66, L70, L71, \
    L72, L73, L74, L75, L76, L77, L80, L81, L82, L83, L84, L85, L86, L87, L88) \
  L00 = sqrt(L00);                                                             \
  L10 /= L00;                                                                  \
  L20 /= L00;                                                                  \
  L30 /= L00;                                                                  \
  L40 /= L00;                                                                  \
  L50 /= L00;                                                                  \
  L60 /= L00;                                                                  \
  L70 /= L00;                                                                  \
  L80 /= L00;                                                                  \
  L11 -= L10 * L10;                                                            \
  L21 -= L20 * L10;                                                            \
  L22 -= L20 * L20;                                                            \
  L31 -= L30 * L10;                                                            \
  L32 -= L30 * L20;                                                            \
  L33 -= L30 * L30;                                                            \
  L41 -= L40 * L10;                                                            \
  L42 -= L40 * L20;                                                            \
  L43 -= L40 * L30;                                                            \
  L44 -= L40 * L40;                                                            \
  L51 -= L50 * L10;                                                            \
  L52 -= L50 * L20;                                                            \
  L53 -= L50 * L30;                                                            \
  L54 -= L50 * L40;                                                            \
  L55 -= L50 * L50;                                                            \
  L61 -= L60 * L10;                                                            \
  L62 -= L60 * L20;                                                            \
  L63 -= L60 * L30;                                                            \
  L64 -= L60 * L40;                                                            \
  L65 -= L60 * L50;                                                            \
  L66 -= L60 * L60;                                                            \
  L71 -= L70 * L10;                                                            \
  L72 -= L70 * L20;                                                            \
  L73 -= L70 * L30;                                                            \
  L74 -= L70 * L40;                                                            \
  L75 -= L70 * L50;                                                            \
  L76 -= L70 * L60;                                                            \
  L77 -= L70 * L70;                                                            \
  L81 -= L80 * L10;                                                            \
  L82 -= L80 * L20;                                                            \
  L83 -= L80 * L30;                                                            \
  L84 -= L80 * L40;                                                            \
  L85 -= L80 * L50;                                                            \
  L86 -= L80 * L60;                                                            \
  L87 -= L80 * L70;                                                            \
  L88 -= L80 * L80;                                                            \
  ComputeL_8x8(L11, L21, L22, L31, L32, L33, L41, L42, L43, L44, L51, L52,     \
               L53, L54, L55, L61, L62, L63, L64, L65, L66, L71, L72, L73,     \
               L74, L75, L76, L77, L81, L82, L83, L84, L85, L86, L87, L88)

#define ComputeL_10x10(L00, L10, L11, L20, L21, L22, L30, L31, L32, L33, L40,  \
                       L41, L42, L43, L44, L50, L51, L52, L53, L54, L55, L60,  \
                       L61, L62, L63, L64, L65, L66, L70, L71, L72, L73, L74,  \
                       L75, L76, L77, L80, L81, L82, L83, L84, L85, L86, L87,  \
                       L88, L90, L91, L92, L93, L94, L95, L96, L97, L98, L99)  \
  L00 = sqrt(L00);                                                             \
  L10 /= L00;                                                                  \
  L20 /= L00;                                                                  \
  L30 /= L00;                                                                  \
  L40 /= L00;                                                                  \
  L50 /= L00;                                                                  \
  L60 /= L00;                                                                  \
  L70 /= L00;                                                                  \
  L80 /= L00;                                                                  \
  L90 /= L00;                                                                  \
  L11 -= L10 * L10;                                                            \
  L21 -= L20 * L10;                                                            \
  L22 -= L20 * L20;                                                            \
  L31 -= L30 * L10;                                                            \
  L32 -= L30 * L20;                                                            \
  L33 -= L30 * L30;                                                            \
  L41 -= L40 * L10;                                                            \
  L42 -= L40 * L20;                                                            \
  L43 -= L40 * L30;                                                            \
  L44 -= L40 * L40;                                                            \
  L51 -= L50 * L10;                                                            \
  L52 -= L50 * L20;                                                            \
  L53 -= L50 * L30;                                                            \
  L54 -= L50 * L40;                                                            \
  L55 -= L50 * L50;                                                            \
  L61 -= L60 * L10;                                                            \
  L62 -= L60 * L20;                                                            \
  L63 -= L60 * L30;                                                            \
  L64 -= L60 * L40;                                                            \
  L65 -= L60 * L50;                                                            \
  L66 -= L60 * L60;                                                            \
  L71 -= L70 * L10;                                                            \
  L72 -= L70 * L20;                                                            \
  L73 -= L70 * L30;                                                            \
  L74 -= L70 * L40;                                                            \
  L75 -= L70 * L50;                                                            \
  L76 -= L70 * L60;                                                            \
  L77 -= L70 * L70;                                                            \
  L81 -= L80 * L10;                                                            \
  L82 -= L80 * L20;                                                            \
  L83 -= L80 * L30;                                                            \
  L84 -= L80 * L40;                                                            \
  L85 -= L80 * L50;                                                            \
  L86 -= L80 * L60;                                                            \
  L87 -= L80 * L70;                                                            \
  L88 -= L80 * L80;                                                            \
  L91 -= L90 * L10;                                                            \
  L92 -= L90 * L20;                                                            \
  L93 -= L90 * L30;                                                            \
  L94 -= L90 * L40;                                                            \
  L95 -= L90 * L50;                                                            \
  L96 -= L90 * L60;                                                            \
  L97 -= L90 * L70;                                                            \
  L98 -= L90 * L80;                                                            \
  L99 -= L90 * L90;                                                            \
  ComputeL_9x9(L11, L21, L22, L31, L32, L33, L41, L42, L43, L44, L51, L52,     \
               L53, L54, L55, L61, L62, L63, L64, L65, L66, L71, L72, L73,     \
               L74, L75, L76, L77, L81, L82, L83, L84, L85, L86, L87, L88,     \
               L91, L92, L93, L94, L95, L96, L97, L98, L99)

#define SolveL_1x1(L00, b0) b0 /= L00;

#define SolveL_2x2(L00, L10, L11, b0, b1)                                      \
  b1 /= L11;                                                                   \
  b0 -= L10 * b1;                                                              \
  SolveL_1x1(L00, b0)

#define SolveL_3x3(L00, L10, L11, L20, L21, L22, b0, b1, b2)                   \
  b2 /= L22;                                                                   \
  b0 -= L20 * b2;                                                              \
  b1 -= L21 * b2;                                                              \
  SolveL_2x2(L00, L10, L11, b0, b1)

#define SolveL_4x4(L00, L10, L11, L20, L21, L22, L30, L31, L32, L33, b0, b1,   \
                   b2, b3)                                                     \
  b3 /= L33;                                                                   \
  b0 -= L30 * b3;                                                              \
  b1 -= L31 * b3;                                                              \
  b2 -= L32 * b3;                                                              \
  SolveL_3x3(L00, L10, L11, L20, L21, L22, b0, b1, b2)

#define SolveL_5x5(L00, L10, L11, L20, L21, L22, L30, L31, L32, L33, L40, L41, \
                   L42, L43, L44, b0, b1, b2, b3, b4)                          \
  b4 /= L44;                                                                   \
  b0 -= L40 * b4;                                                              \
  b1 -= L41 * b4;                                                              \
  b2 -= L42 * b4;                                                              \
  b3 -= L43 * b4;                                                              \
  SolveL_4x4(L00, L10, L11, L20, L21, L22, L30, L31, L32, L33, b0, b1, b2, b3)

#define SolveL_6x6(L00, L10, L11, L20, L21, L22, L30, L31, L32, L33, L40, L41, \
                   L42, L43, L44, L50, L51, L52, L53, L54, L55, b0, b1, b2,    \
                   b3, b4, b5)                                                 \
  b5 /= L55;                                                                   \
  b0 -= L50 * b5;                                                              \
  b1 -= L51 * b5;                                                              \
  b2 -= L52 * b5;                                                              \
  b3 -= L53 * b5;                                                              \
  b4 -= L54 * b5;                                                              \
  SolveL_5x5(L00, L10, L11, L20, L21, L22, L30, L31, L32, L33, L40, L41, L42,  \
             L43, L44, b0, b1, b2, b3, b4)

#define SolveL_7x7(L00, L10, L11, L20, L21, L22, L30, L31, L32, L33, L40, L41, \
                   L42, L43, L44, L50, L51, L52, L53, L54, L55, L60, L61, L62, \
                   L63, L64, L65, L66, b0, b1, b2, b3, b4, b5, b6)             \
  b6 /= L66;                                                                   \
  b0 -= L60 * b6;                                                              \
  b1 -= L61 * b6;                                                              \
  b2 -= L62 * b6;                                                              \
  b3 -= L63 * b6;                                                              \
  b4 -= L64 * b6;                                                              \
  b5 -= L65 * b6;                                                              \
  SolveL_6x6(L00, L10, L11, L20, L21, L22, L30, L31, L32, L33, L40, L41, L42,  \
             L43, L44, L50, L51, L52, L53, L54, L55, b0, b1, b2, b3, b4, b5)

#define SolveL_8x8(L00, L10, L11, L20, L21, L22, L30, L31, L32, L33, L40, L41, \
                   L42, L43, L44, L50, L51, L52, L53, L54, L55, L60, L61, L62, \
                   L63, L64, L65, L66, L70, L71, L72, L73, L74, L75, L76, L77, \
                   b0, b1, b2, b3, b4, b5, b6, b7)                             \
  b7 /= L77;                                                                   \
  b0 -= L70 * b7;                                                              \
  b1 -= L71 * b7;                                                              \
  b2 -= L72 * b7;                                                              \
  b3 -= L73 * b7;                                                              \
  b4 -= L74 * b7;                                                              \
  b5 -= L75 * b7;                                                              \
  b6 -= L76 * b7;                                                              \
  SolveL_7x7(L00, L10, L11, L20, L21, L22, L30, L31, L32, L33, L40, L41, L42,  \
             L43, L44, L50, L51, L52, L53, L54, L55, L60, L61, L62, L63, L64,  \
             L65, L66, b0, b1, b2, b3, b4, b5, b6)

#define SolveL_9x9(L00, L10, L11, L20, L21, L22, L30, L31, L32, L33, L40, L41, \
                   L42, L43, L44, L50, L51, L52, L53, L54, L55, L60, L61, L62, \
                   L63, L64, L65, L66, L70, L71, L72, L73, L74, L75, L76, L77, \
                   L80, L81, L82, L83, L84, L85, L86, L87, L88, b0, b1, b2,    \
                   b3, b4, b5, b6, b7, b8)                                     \
  b8 /= L88;                                                                   \
  b0 -= L80 * b8;                                                              \
  b1 -= L81 * b8;                                                              \
  b2 -= L82 * b8;                                                              \
  b3 -= L83 * b8;                                                              \
  b4 -= L84 * b8;                                                              \
  b5 -= L85 * b8;                                                              \
  b6 -= L86 * b8;                                                              \
  b7 -= L87 * b8;                                                              \
  SolveL_8x8(L00, L10, L11, L20, L21, L22, L30, L31, L32, L33, L40, L41, L42,  \
             L43, L44, L50, L51, L52, L53, L54, L55, L60, L61, L62, L63, L64,  \
             L65, L66, L70, L71, L72, L73, L74, L75, L76, L77, b0, b1, b2, b3, \
             b4, b5, b6, b7)

#define SolveL_10x10(L00, L10, L11, L20, L21, L22, L30, L31, L32, L33, L40,    \
                     L41, L42, L43, L44, L50, L51, L52, L53, L54, L55, L60,    \
                     L61, L62, L63, L64, L65, L66, L70, L71, L72, L73, L74,    \
                     L75, L76, L77, L80, L81, L82, L83, L84, L85, L86, L87,    \
                     L88, L90, L91, L92, L93, L94, L95, L96, L97, L98, L99,    \
                     b0, b1, b2, b3, b4, b5, b6, b7, b8, b9)                   \
  b9 /= L99;                                                                   \
  b0 -= L90 * b9;                                                              \
  b1 -= L91 * b9;                                                              \
  b2 -= L92 * b9;                                                              \
  b3 -= L93 * b9;                                                              \
  b4 -= L94 * b9;                                                              \
  b5 -= L95 * b9;                                                              \
  b6 -= L96 * b9;                                                              \
  b7 -= L97 * b9;                                                              \
  b8 -= L98 * b9;                                                              \
  SolveL_9x9(L00, L10, L11, L20, L21, L22, L30, L31, L32, L33, L40, L41, L42,  \
             L43, L44, L50, L51, L52, L53, L54, L55, L60, L61, L62, L63, L64,  \
             L65, L66, L70, L71, L72, L73, L74, L75, L76, L77, L80, L81, L82,  \
             L83, L84, L85, L86, L87, L88, b0, b1, b2, b3, b4, b5, b6, b7, b8)

#define ComputeCholInv_1x1(L00, X00) X00 /= L00;

#define ComputeCholInv_2x2(L00, L10, L11, X00, X10, X11)                       \
  SolveL_2x2(L00, L10, L11, X10, X11);                                         \
  X00 -= X10 * L10;                                                            \
  ComputeCholInv_1x1(L00, X00);

#define ComputeCholInv_3x3(L00, L10, L11, L20, L21, L22, X00, X10, X11, X20,   \
                           X21, X22)                                           \
  SolveL_3x3(L00, L10, L11, L20, L21, L22, X20, X21, X22);                     \
  X00 -= X20 * L20;                                                            \
  X10 -= X21 * L20;                                                            \
  X11 -= X21 * L21;                                                            \
  ComputeCholInv_2x2(L00, L10, L11, X00, X10, X11)

#define ComputeCholInv_4x4(L00, L10, L11, L20, L21, L22, L30, L31, L32, L33,   \
                           X00, X10, X11, X20, X21, X22, X30, X31, X32, X33)   \
  SolveL_4x4(L00, L10, L11, L20, L21, L22, L30, L31, L32, L33, X30, X31, X32,  \
             X33);                                                             \
  X00 -= X30 * L30;                                                            \
  X10 -= X31 * L30;                                                            \
  X11 -= X31 * L31;                                                            \
  X20 -= X32 * L30;                                                            \
  X21 -= X32 * L31;                                                            \
  X22 -= X32 * L32;                                                            \
  ComputeCholInv_3x3(L00, L10, L11, L20, L21, L22, X00, X10, X11, X20, X21, X22)

#define ComputeCholInv_5x5(L00, L10, L11, L20, L21, L22, L30, L31, L32, L33,   \
                           L40, L41, L42, L43, L44, X00, X10, X11, X20, X21,   \
                           X22, X30, X31, X32, X33, X40, X41, X42, X43, X44)   \
  SolveL_5x5(L00, L10, L11, L20, L21, L22, L30, L31, L32, L33, L40, L41, L42,  \
             L43, L44, X40, X41, X42, X43, X44);                               \
  X00 -= X40 * L40;                                                            \
  X10 -= X41 * L40;                                                            \
  X11 -= X41 * L41;                                                            \
  X20 -= X42 * L40;                                                            \
  X21 -= X42 * L41;                                                            \
  X22 -= X42 * L42;                                                            \
  X30 -= X43 * L40;                                                            \
  X31 -= X43 * L41;                                                            \
  X32 -= X43 * L42;                                                            \
  X33 -= X43 * L43;                                                            \
  ComputeCholInv_4x4(L00, L10, L11, L20, L21, L22, L30, L31, L32, L33, X00,    \
                     X10, X11, X20, X21, X22, X30, X31, X32, X33)

#define ComputeCholInv_6x6(                                                    \
    L00, L10, L11, L20, L21, L22, L30, L31, L32, L33, L40, L41, L42, L43, L44, \
    L50, L51, L52, L53, L54, L55, X00, X10, X11, X20, X21, X22, X30, X31, X32, \
    X33, X40, X41, X42, X43, X44, X50, X51, X52, X53, X54, X55)                \
  SolveL_6x6(L00, L10, L11, L20, L21, L22, L30, L31, L32, L33, L40, L41, L42,  \
             L43, L44, L50, L51, L52, L53, L54, L55, X50, X51, X52, X53, X54,  \
             X55);                                                             \
  X00 -= X50 * L50;                                                            \
  X10 -= X51 * L50;                                                            \
  X11 -= X51 * L51;                                                            \
  X20 -= X52 * L50;                                                            \
  X21 -= X52 * L51;                                                            \
  X22 -= X52 * L52;                                                            \
  X30 -= X53 * L50;                                                            \
  X31 -= X53 * L51;                                                            \
  X32 -= X53 * L52;                                                            \
  X33 -= X53 * L53;                                                            \
  X40 -= X54 * L50;                                                            \
  X41 -= X54 * L51;                                                            \
  X42 -= X54 * L52;                                                            \
  X43 -= X54 * L53;                                                            \
  X44 -= X54 * L54;                                                            \
  ComputeCholInv_5x5(L00, L10, L11, L20, L21, L22, L30, L31, L32, L33, L40,    \
                     L41, L42, L43, L44, X00, X10, X11, X20, X21, X22, X30,    \
                     X31, X32, X33, X40, X41, X42, X43, X44)

#define ComputeCholInv_7x7(                                                    \
    L00, L10, L11, L20, L21, L22, L30, L31, L32, L33, L40, L41, L42, L43, L44, \
    L50, L51, L52, L53, L54, L55, L60, L61, L62, L63, L64, L65, L66, X00, X10, \
    X11, X20, X21, X22, X30, X31, X32, X33, X40, X41, X42, X43, X44, X50, X51, \
    X52, X53, X54, X55, X60, X61, X62, X63, X64, X65, X66)                     \
  SolveL_7x7(L00, L10, L11, L20, L21, L22, L30, L31, L32, L33, L40, L41, L42,  \
             L43, L44, L50, L51, L52, L53, L54, L55, L60, L61, L62, L63, L64,  \
             L65, L66, X60, X61, X62, X63, X64, X65, X66);                     \
  X00 -= X60 * L60;                                                            \
  X10 -= X61 * L60;                                                            \
  X11 -= X61 * L61;                                                            \
  X20 -= X62 * L60;                                                            \
  X21 -= X62 * L61;                                                            \
  X22 -= X62 * L62;                                                            \
  X30 -= X63 * L60;                                                            \
  X31 -= X63 * L61;                                                            \
  X32 -= X63 * L62;                                                            \
  X33 -= X63 * L63;                                                            \
  X40 -= X64 * L60;                                                            \
  X41 -= X64 * L61;                                                            \
  X42 -= X64 * L62;                                                            \
  X43 -= X64 * L63;                                                            \
  X44 -= X64 * L64;                                                            \
  X50 -= X65 * L60;                                                            \
  X51 -= X65 * L61;                                                            \
  X52 -= X65 * L62;                                                            \
  X53 -= X65 * L63;                                                            \
  X54 -= X65 * L64;                                                            \
  X55 -= X65 * L65;                                                            \
  ComputeCholInv_6x6(L00, L10, L11, L20, L21, L22, L30, L31, L32, L33, L40,    \
                     L41, L42, L43, L44, L50, L51, L52, L53, L54, L55, X00,    \
                     X10, X11, X20, X21, X22, X30, X31, X32, X33, X40, X41,    \
                     X42, X43, X44, X50, X51, X52, X53, X54, X55)

#define ComputeCholInv_8x8(                                                    \
    L00, L10, L11, L20, L21, L22, L30, L31, L32, L33, L40, L41, L42, L43, L44, \
    L50, L51, L52, L53, L54, L55, L60, L61, L62, L63, L64, L65, L66, L70, L71, \
    L72, L73, L74, L75, L76, L77, X00, X10, X11, X20, X21, X22, X30, X31, X32, \
    X33, X40, X41, X42, X43, X44, X50, X51, X52, X53, X54, X55, X60, X61, X62, \
    X63, X64, X65, X66, X70, X71, X72, X73, X74, X75, X76, X77)                \
  SolveL_8x8(L00, L10, L11, L20, L21, L22, L30, L31, L32, L33, L40, L41, L42,  \
             L43, L44, L50, L51, L52, L53, L54, L55, L60, L61, L62, L63, L64,  \
             L65, L66, L70, L71, L72, L73, L74, L75, L76, L77, X70, X71, X72,  \
             X73, X74, X75, X76, X77);                                         \
  X00 -= X70 * L70;                                                            \
  X10 -= X71 * L70;                                                            \
  X11 -= X71 * L71;                                                            \
  X20 -= X72 * L70;                                                            \
  X21 -= X72 * L71;                                                            \
  X22 -= X72 * L72;                                                            \
  X30 -= X73 * L70;                                                            \
  X31 -= X73 * L71;                                                            \
  X32 -= X73 * L72;                                                            \
  X33 -= X73 * L73;                                                            \
  X40 -= X74 * L70;                                                            \
  X41 -= X74 * L71;                                                            \
  X42 -= X74 * L72;                                                            \
  X43 -= X74 * L73;                                                            \
  X44 -= X74 * L74;                                                            \
  X50 -= X75 * L70;                                                            \
  X51 -= X75 * L71;                                                            \
  X52 -= X75 * L72;                                                            \
  X53 -= X75 * L73;                                                            \
  X54 -= X75 * L74;                                                            \
  X55 -= X75 * L75;                                                            \
  X60 -= X76 * L70;                                                            \
  X61 -= X76 * L71;                                                            \
  X62 -= X76 * L72;                                                            \
  X63 -= X76 * L73;                                                            \
  X64 -= X76 * L74;                                                            \
  X65 -= X76 * L75;                                                            \
  X66 -= X76 * L76;                                                            \
  ComputeCholInv_7x7(                                                          \
      L00, L10, L11, L20, L21, L22, L30, L31, L32, L33, L40, L41, L42, L43,    \
      L44, L50, L51, L52, L53, L54, L55, L60, L61, L62, L63, L64, L65, L66,    \
      X00, X10, X11, X20, X21, X22, X30, X31, X32, X33, X40, X41, X42, X43,    \
      X44, X50, X51, X52, X53, X54, X55, X60, X61, X62, X63, X64, X65, X66)

#define ComputeCholInv_9x9(                                                    \
    L00, L10, L11, L20, L21, L22, L30, L31, L32, L33, L40, L41, L42, L43, L44, \
    L50, L51, L52, L53, L54, L55, L60, L61, L62, L63, L64, L65, L66, L70, L71, \
    L72, L73, L74, L75, L76, L77, L80, L81, L82, L83, L84, L85, L86, L87, L88, \
    X00, X10, X11, X20, X21, X22, X30, X31, X32, X33, X40, X41, X42, X43, X44, \
    X50, X51, X52, X53, X54, X55, X60, X61, X62, X63, X64, X65, X66, X70, X71, \
    X72, X73, X74, X75, X76, X77, X80, X81, X82, X83, X84, X85, X86, X87, X88) \
  SolveL_9x9(L00, L10, L11, L20, L21, L22, L30, L31, L32, L33, L40, L41, L42,  \
             L43, L44, L50, L51, L52, L53, L54, L55, L60, L61, L62, L63, L64,  \
             L65, L66, L70, L71, L72, L73, L74, L75, L76, L77, L80, L81, L82,  \
             L83, L84, L85, L86, L87, L88, X80, X81, X82, X83, X84, X85, X86,  \
             X87, X88);                                                        \
  X00 -= X80 * L80;                                                            \
  X10 -= X81 * L80;                                                            \
  X11 -= X81 * L81;                                                            \
  X20 -= X82 * L80;                                                            \
  X21 -= X82 * L81;                                                            \
  X22 -= X82 * L82;                                                            \
  X30 -= X83 * L80;                                                            \
  X31 -= X83 * L81;                                                            \
  X32 -= X83 * L82;                                                            \
  X33 -= X83 * L83;                                                            \
  X40 -= X84 * L80;                                                            \
  X41 -= X84 * L81;                                                            \
  X42 -= X84 * L82;                                                            \
  X43 -= X84 * L83;                                                            \
  X44 -= X84 * L84;                                                            \
  X50 -= X85 * L80;                                                            \
  X51 -= X85 * L81;                                                            \
  X52 -= X85 * L82;                                                            \
  X53 -= X85 * L83;                                                            \
  X54 -= X85 * L84;                                                            \
  X55 -= X85 * L85;                                                            \
  X60 -= X86 * L80;                                                            \
  X61 -= X86 * L81;                                                            \
  X62 -= X86 * L82;                                                            \
  X63 -= X86 * L83;                                                            \
  X64 -= X86 * L84;                                                            \
  X65 -= X86 * L85;                                                            \
  X66 -= X86 * L86;                                                            \
  X70 -= X87 * L80;                                                            \
  X71 -= X87 * L81;                                                            \
  X72 -= X87 * L82;                                                            \
  X73 -= X87 * L83;                                                            \
  X74 -= X87 * L84;                                                            \
  X75 -= X87 * L85;                                                            \
  X76 -= X87 * L86;                                                            \
  X77 -= X87 * L87;                                                            \
  ComputeCholInv_8x8(L00, L10, L11, L20, L21, L22, L30, L31, L32, L33, L40,    \
                     L41, L42, L43, L44, L50, L51, L52, L53, L54, L55, L60,    \
                     L61, L62, L63, L64, L65, L66, L70, L71, L72, L73, L74,    \
                     L75, L76, L77, X00, X10, X11, X20, X21, X22, X30, X31,    \
                     X32, X33, X40, X41, X42, X43, X44, X50, X51, X52, X53,    \
                     X54, X55, X60, X61, X62, X63, X64, X65, X66, X70, X71,    \
                     X72, X73, X74, X75, X76, X77)

#define ComputeCholInv_10x10(                                                  \
    L00, L10, L11, L20, L21, L22, L30, L31, L32, L33, L40, L41, L42, L43, L44, \
    L50, L51, L52, L53, L54, L55, L60, L61, L62, L63, L64, L65, L66, L70, L71, \
    L72, L73, L74, L75, L76, L77, L80, L81, L82, L83, L84, L85, L86, L87, L88, \
    L90, L91, L92, L93, L94, L95, L96, L97, L98, L99, X00, X10, X11, X20, X21, \
    X22, X30, X31, X32, X33, X40, X41, X42, X43, X44, X50, X51, X52, X53, X54, \
    X55, X60, X61, X62, X63, X64, X65, X66, X70, X71, X72, X73, X74, X75, X76, \
    X77, X80, X81, X82, X83, X84, X85, X86, X87, X88, X90, X91, X92, X93, X94, \
    X95, X96, X97, X98, X99)                                                   \
  SolveL_10x10(L00, L10, L11, L20, L21, L22, L30, L31, L32, L33, L40, L41,     \
               L42, L43, L44, L50, L51, L52, L53, L54, L55, L60, L61, L62,     \
               L63, L64, L65, L66, L70, L71, L72, L73, L74, L75, L76, L77,     \
               L80, L81, L82, L83, L84, L85, L86, L87, L88, L90, L91, L92,     \
               L93, L94, L95, L96, L97, L98, L99, X90, X91, X92, X93, X94,     \
               X95, X96, X97, X98, X99);                                       \
  X00 -= X90 * L90;                                                            \
  X10 -= X91 * L90;                                                            \
  X11 -= X91 * L91;                                                            \
  X20 -= X92 * L90;                                                            \
  X21 -= X92 * L91;                                                            \
  X22 -= X92 * L92;                                                            \
  X30 -= X93 * L90;                                                            \
  X31 -= X93 * L91;                                                            \
  X32 -= X93 * L92;                                                            \
  X33 -= X93 * L93;                                                            \
  X40 -= X94 * L90;                                                            \
  X41 -= X94 * L91;                                                            \
  X42 -= X94 * L92;                                                            \
  X43 -= X94 * L93;                                                            \
  X44 -= X94 * L94;                                                            \
  X50 -= X95 * L90;                                                            \
  X51 -= X95 * L91;                                                            \
  X52 -= X95 * L92;                                                            \
  X53 -= X95 * L93;                                                            \
  X54 -= X95 * L94;                                                            \
  X55 -= X95 * L95;                                                            \
  X60 -= X96 * L90;                                                            \
  X61 -= X96 * L91;                                                            \
  X62 -= X96 * L92;                                                            \
  X63 -= X96 * L93;                                                            \
  X64 -= X96 * L94;                                                            \
  X65 -= X96 * L95;                                                            \
  X66 -= X96 * L96;                                                            \
  X70 -= X97 * L90;                                                            \
  X71 -= X97 * L91;                                                            \
  X72 -= X97 * L92;                                                            \
  X73 -= X97 * L93;                                                            \
  X74 -= X97 * L94;                                                            \
  X75 -= X97 * L95;                                                            \
  X76 -= X97 * L96;                                                            \
  X77 -= X97 * L97;                                                            \
  X80 -= X98 * L90;                                                            \
  X81 -= X98 * L91;                                                            \
  X82 -= X98 * L92;                                                            \
  X83 -= X98 * L93;                                                            \
  X84 -= X98 * L94;                                                            \
  X85 -= X98 * L95;                                                            \
  X86 -= X98 * L96;                                                            \
  X87 -= X98 * L97;                                                            \
  X88 -= X98 * L98;                                                            \
  ComputeCholInv_9x9(                                                          \
      L00, L10, L11, L20, L21, L22, L30, L31, L32, L33, L40, L41, L42, L43,    \
      L44, L50, L51, L52, L53, L54, L55, L60, L61, L62, L63, L64, L65, L66,    \
      L70, L71, L72, L73, L74, L75, L76, L77, L80, L81, L82, L83, L84, L85,    \
      L86, L87, L88, X00, X10, X11, X20, X21, X22, X30, X31, X32, X33, X40,    \
      X41, X42, X43, X44, X50, X51, X52, X53, X54, X55, X60, X61, X62, X63,    \
      X64, X65, X66, X70, X71, X72, X73, X74, X75, X76, X77, X80, X81, X82,    \
      X83, X84, X85, X86, X87, X88)